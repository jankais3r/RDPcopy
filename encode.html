<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>RDPCopy Encode</title>
        <style>
            body {
                background: #F0F0F0;
                font-family: sans-serif;
            }
            h2 {
                margin-top: 35px;
                margin-left: 55px;
            }
            #drop-area {
                margin-top: 35px;
                margin-left: 50px;
                font-family: monospace;
                width: 500px;
                height: 250px;
                background-color: rgba(0, 0, 0, 0.07);
                border-radius: 6px;
                border-style: dashed;
                color: #555555;
                font-size: 1em;
                line-height: 1.4em;
                padding: 5px 8px;
                transition: background-color 0.2s ease 0s;
                cursor: pointer;
            }
            .highlight {
                background-color: #FFFFFF !important;
            }
            #drop-area:hover {
                background-color: #FFFFFF;
            }
            @keyframes glow {
                0% {
                    box-shadow: 0 0 0 0 #0075e0ff;
                }
                100% {
                    box-shadow: 0 0 30px 15px #0075e000;
                }
            }
        </style>
    </head>
    <body>
        <h2>RDPCopy Encode</h2>
        <div id="drop-area">Drop yo file...</div>
        <input type="file" id="file-input" style="display:none">
        <button id="copy-button" style="display:none">Copy file</button>
        <script>
            var dropArea = document.getElementById('drop-area');
            var fileInput = document.getElementById('file-input');
            var copyButton = document.getElementById('copy-button');
            var fileData = '';
            var isSafari = navigator.userAgent.includes("Safari") && !navigator.userAgent.includes("Chrome");
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            dropArea.addEventListener('drop', handleDrop, false);
            dropArea.addEventListener('click', handleFileInputClick);
            fileInput.addEventListener('change', () => handleFiles(fileInput.files));
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            function highlight(e) {
                dropArea.classList.add('highlight');
            }
            function unhighlight(e) {
                dropArea.classList.remove('highlight');
            }
            function handleDrop(e) {
                var dt = e.dataTransfer;
                var files = dt.files;
                handleFiles(files);
            }
            function handleFiles(files) {
                files = [... files];
                encodeFile(files[0]);
            }
            function handleFileInputClick() {
                fileInput.click();
            }
            function encodeFile(file) {
                var reader = new FileReader();
                reader.readAsDataURL(file);
                var filename = file.name;
                reader.onloadend = function () {
                    fileData = reader.result.substring(reader.result.indexOf('base64,') + 7) + '\n' + filename;
                    if (isSafari) {
                        dropArea.innerText = 'Click to copy file data.';
                        dropArea.removeEventListener('click', handleFileInputClick);
                        dropArea.onclick = function () {
                            copyToClipboard(fileData, true);
                        };
                    } else {
                        setTimeout(() => {
                            copyToClipboard(fileData, false);
                        }, 100);
                    }
                }
            }
            function copyToClipboard(data, isSafari) {
                try {
                    navigator
                        .clipboard
                        .writeText(data)
                        .then(() => {
                            dropArea.innerText = 'File encoded and copied!';
                            dropArea.style.animation = 'glow 0.75s ease forwards';
                            if (isSafari) {
                                setTimeout(() => {
                                    dropArea.style.animation = '';
                                    dropArea.innerText = 'Drop yo file...';
                                    dropArea.onclick = null;
                                    dropArea.addEventListener('click', handleFileInputClick);
                                }, 2000);
                            } else {
                                setTimeout(() => {
                                    dropArea.style.animation = '';
                                    dropArea.innerText = 'Drop yo file...';
                                }, 2000);
                            }
                        })
                        .catch(err => {
                            alert('Failed to write to clipboard: ' + err);
                            if (isSafari) {
                                restoreClickHandler();
                            }
                        });
                } catch (err) {
                    alert('Failed to write to clipboard: ' + err);
                    if (isSafari) {
                        restoreClickHandler();
                    }
                }
            }
        </script>
    </body>
</html>